---

title: Title


keywords: fastai
sidebar: home_sidebar



nb_path: "DatabaseMigration.ipynb"
---
<!--

#################################################
### THIS FILE WAS AUTOGENERATED! DO NOT EDIT! ###
#################################################
# file to edit: DatabaseMigration.ipynb
# command to build the docs after a change: nbdev_build_docs

-->

<div class="container" id="notebook-container">
        
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="o">!</span>which python
<span class="o">!</span>python --version
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre>/home/ec2-user/anaconda3/envs/JupyterSystemEnv/bin/python
Python 3.6.11
</pre>
</div>
</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="kn">from</span> <span class="nn">villaProductSdk.products</span> <span class="kn">import</span> <span class="n">ProductSdk</span>
<span class="kn">from</span> <span class="nn">nicHelper.dictUtil</span> <span class="kn">import</span> <span class="n">printDict</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">

<div class="output_subarea output_text output_error">
<pre>

<span class="ansi-red-fg">ImportError</span>Traceback (most recent call last)
<span class="ansi-green-fg">&lt;ipython-input-1-96eb829db5b3&gt;</span> in <span class="ansi-cyan-fg">&lt;module&gt;</span><span class="ansi-blue-fg">()</span>
<span class="ansi-green-fg">----&gt; 1</span><span class="ansi-red-fg"> </span><span class="ansi-green-fg">from</span> villaProductSdk<span class="ansi-blue-fg">.</span>products <span class="ansi-green-fg">import</span> ProductSdk
<span class="ansi-green-intense-fg ansi-bold">      2</span> <span class="ansi-green-fg">from</span> nicHelper<span class="ansi-blue-fg">.</span>dictUtil <span class="ansi-green-fg">import</span> printDict

<span class="ansi-red-fg">ImportError</span>: No module named villaProductSdk.products</pre>
</div>
</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">psdk</span> <span class="o">=</span> <span class="n">ProductSdk</span><span class="p">(</span><span class="n">branch</span><span class="o">=</span><span class="s1">&#39;dev-manual&#39;</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span> 
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="o">%%time</span>
<span class="n">psdk</span><span class="o">.</span><span class="n">printFirst</span><span class="p">(</span><span class="n">psdk</span><span class="o">.</span><span class="n">allQuery</span><span class="p">())</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre>CPU times: user 1.01 s, sys: 0 ns, total: 1.01 s
Wall time: 3.17 s
</pre>
</div>
</div>

<div class="output_area">



<div class="output_text output_subarea output_execute_result">
<pre>(&#39;0217153&#39;,
 {&#39;0217153&#39;: {&#39;cprcode&#39;: &#39;0217153&#39;,
   &#39;iprcode&#39;: &#39;0217153&#39;,
   &#39;oprcode&#39;: &#39;0217153&#39;,
   &#39;ordertype&#39;: &#39;Y&#39;,
   &#39;pr_abb&#39;: &#39;COCOA LOCO MILK CHOC&#39;,
   &#39;pr_active&#39;: &#39;Y&#39;,
   &#39;pr_cgcode&#39;: &#39;98&#39;,
   &#39;pr_code&#39;: &#39;0217153&#39;,
   &#39;pr_dpcode&#39;: &#39;28&#39;,
   &#39;pr_engname&#39;: &#39;COCOA LOCO MILK CHOCOLATE OWL LOLLY 26G.&#39;,
   &#39;pr_ggcode&#39;: &#39;003&#39;,
   &#39;pr_market&#39;: &#39;COCOA LOCO MILK CHOCOLATE OWL&#39;,
   &#39;pr_name&#39;: &#39;COCOA LOCO MILK CHOCOLATE OWL LOLLY 26G.&#39;,
   &#39;pr_puqty&#39;: &#39;24&#39;,
   &#39;pr_sa_method&#39;: &#39;1&#39;,
   &#39;pr_sucode1&#39;: &#39;F1222&#39;,
   &#39;pr_suref3&#39;: &#39;S&#39;,
   &#39;prtype&#39;: &#39;I&#39;,
   &#39;psqty&#39;: &#39;1&#39;,
   &#39;pstype&#39;: &#39;1&#39;}})</pre>
</div>

</div>

</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h2 id="define-dataclass-for-original-dynamodb">define dataclass for original dynamodb<a class="anchor-link" href="#define-dataclass-for-original-dynamodb"> </a></h2>
</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="kn">from</span> <span class="nn">pynamodb.models</span> <span class="kn">import</span> <span class="n">Model</span>
<span class="kn">from</span> <span class="nn">pynamodb.attributes</span> <span class="kn">import</span> <span class="n">UnicodeAttribute</span><span class="p">,</span> <span class="n">JSONAttribute</span>

<span class="k">class</span> <span class="nc">ProductMaster</span><span class="p">(</span><span class="n">Model</span><span class="p">):</span>
  <span class="k">class</span> <span class="nc">Meta</span><span class="p">:</span>
    <span class="n">table_name</span><span class="o">=</span> <span class="s1">&#39;villa-product-master&#39;</span>
    <span class="n">region</span> <span class="o">=</span> <span class="s1">&#39;ap-southeast-1&#39;</span>
  <span class="n">iprcode</span> <span class="o">=</span> <span class="n">UnicodeAttribute</span><span class="p">(</span><span class="n">hash_key</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
  <span class="n">cprcode</span> <span class="o">=</span> <span class="n">UnicodeAttribute</span><span class="p">(</span><span class="n">range_key</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
  <span class="n">details</span> <span class="o">=</span> <span class="n">JSONAttribute</span><span class="p">()</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h3 id="Get-all-items">Get all items<a class="anchor-link" href="#Get-all-items"> </a></h3>
</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">items</span> <span class="o">=</span> <span class="p">[</span><span class="n">item</span><span class="o">.</span><span class="n">details</span> <span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="n">ProductMaster</span><span class="o">.</span><span class="n">scan</span><span class="p">(</span><span class="n">limit</span><span class="o">=</span><span class="mi">100000</span><span class="p">)]</span>
<span class="nb">print</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">items</span><span class="p">))</span>
<span class="nb">print</span><span class="p">(</span><span class="n">items</span><span class="p">[:</span><span class="mi">2</span><span class="p">])</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre>68978
[{&#39;cprcode&#39;: &#39;0140942&#39;, &#39;iprcode&#39;: &#39;0140942&#39;, &#39;oprcode&#39;: &#39;0140942&#39;, &#39;ordertype&#39;: &#39;Y&#39;, &#39;pr_abb&#39;: &#39;FRAGATA OLIVE POMACE&#39;, &#39;pr_active&#39;: &#39;Y&#39;, &#39;pr_cgcode&#39;: &#39;01&#39;, &#39;pr_code&#39;: &#39;0140942&#39;, &#39;pr_dpcode&#39;: &#39;08&#39;, &#39;pr_engname&#39;: &#39;FRAGATA OLIVE POMACE OIL 2 LITE&#39;, &#39;pr_ggcode&#39;: &#39;008&#39;, &#39;pr_market&#39;: &#39;FRAGATA น้ำมันมะกอกธรรมชาติผสม&#39;, &#39;pr_name&#39;: &#39;FRAGATA น้ำมันมะกอกธรรมชาติ-กรรมวิธี 2 ลิตร&#39;, &#39;pr_puqty&#39;: &#39;8.00&#39;, &#39;pr_sa_method&#39;: &#39;1&#39;, &#39;pr_sucode1&#39;: &#39;1036&#39;, &#39;pr_suref3&#39;: &#39;A&#39;, &#39;prtype&#39;: &#39;I&#39;, &#39;psqty&#39;: &#39;1&#39;, &#39;pstype&#39;: &#39;1&#39;, &#39;pr_country_th&#39;: &#39;&#39;, &#39;pr_country_en&#39;: &#39;&#39;, &#39;pr_keyword_th&#39;: &#39;&#39;, &#39;pr_keyword_en&#39;: &#39;cooking oil, oil cooking,Fragata Olive Pomace Oil, Fragata, Olive purity pomace oil, Omace oil olive pomace oil, cooking olive pomace oil, olive pomace oil cooking\r\n&#39;, &#39;pr_filter_th&#39;: &#39;Oils  Vinegar,Grocery&#39;, &#39;pr_filter_en&#39;: &#39;Oils  Vinegar,Grocery&#39;, &#39;online_category_l1_th&#39;: &#39;สินค้าบริโภค&#39;, &#39;online_category_l1_en&#39;: &#39;Grocery&#39;, &#39;online_category_l2_th&#39;: &#39;น้ำมันและน้ำส้มสายชู&#39;, &#39;online_category_l2_en&#39;: &#39;Oils &amp; Vinegar&#39;, &#39;online_category_l3_th&#39;: &#39;&#39;, &#39;online_category_l3_en&#39;: &#39;&#39;, &#39;villa_category_l1_en&#39;: &#39;Dry Grocery&#39;, &#39;villa_category_l2_en&#39;: &#39;Grocery&#39;, &#39;villa_category_l3_en&#39;: &#39;Oil &amp; Seasoning &amp; Sauce&#39;, &#39;villa_category_l4_en&#39;: &#39;Cooking Oil&#39;, &#39;content_en&#39;: &#39;0140942 Fragata Olive Pomace Oil 2L cooking oil, oil cooking,Fragata Olive Pomace Oil, Fragata, Olive purity pomace oil, Omace oil olive pomace oil, cooking olive pomace oil, olive pomace oil cooking\r\n&#39;, &#39;content_th&#39;: &#39;Fragata Olive Pomace Oil 2L&#39;, &#39;hema_brand_th&#39;: &#39;Fragata&#39;, &#39;hema_brand_en&#39;: &#39;Fragata&#39;, &#39;hema_sizedesc&#39;: &#39;2L&#39;, &#39;pr_brand_en&#39;: &#39;Fragata&#39;, &#39;pr_brand_th&#39;: &#39;Fragata&#39;, &#39;pr_online_name_en&#39;: &#39;Fragata Olive Pomace Oil 2L&#39;, &#39;pr_online_name_th&#39;: &#39;Fragata Olive Pomace Oil 2L&#39;, &#39;hema_name_en&#39;: &#39;Olive Pomace Oil&#39;, &#39;hema_name_th&#39;: &#39;Olive Pomace Oil&#39;, &#39;pr_name_en&#39;: &#39;FRAGATA OLIVE POMACE OIL 2 LITE&#39;, &#39;pr_name_th&#39;: &#39;FRAGATA น้ำมันมะกอกธรรมชาติ-กรรมวิธี 2 ลิตร&#39;, &#39;pr_barcode&#39;: &#39;8410134118601&#39;, &#39;pr_barcode2&#39;: &#39;841013411860&#39;, &#39;sort_weight&#39;: &#39;0&#39;}, {&#39;cprcode&#39;: &#39;0223750&#39;, &#39;iprcode&#39;: &#39;0223750&#39;, &#39;oprcode&#39;: &#39;0223750&#39;, &#39;ordertype&#39;: &#39;Y&#39;, &#39;pr_abb&#39;: &#39;SAMYANG HOT CHICKHEN&#39;, &#39;pr_active&#39;: &#39;Y&#39;, &#39;pr_cgcode&#39;: &#39;04&#39;, &#39;pr_code&#39;: &#39;0223750&#39;, &#39;pr_dpcode&#39;: &#39;03&#39;, &#39;pr_engname&#39;: &#39;SAMYANG HOT CHICKHEN CARBONARA130G&#39;, &#39;pr_ggcode&#39;: &#39;002&#39;, &#39;pr_market&#39;: &#39;SAMYANG ฮอตชิคเค่น คาโบนาร่า 1&#39;, &#39;pr_name&#39;: &#39;SAMYANG ฮอตชิคเค่น คาโบนาร่า 130กรัม&#39;, &#39;pr_puqty&#39;: &#39;40.00&#39;, &#39;pr_sa_method&#39;: &#39;1&#39;, &#39;pr_sucode1&#39;: &#39;2551&#39;, &#39;pr_suref3&#39;: &#39;A&#39;, &#39;prtype&#39;: &#39;I&#39;, &#39;psqty&#39;: &#39;1&#39;, &#39;pstype&#39;: &#39;1&#39;, &#39;pr_country_th&#39;: &#39;&#39;, &#39;pr_country_en&#39;: &#39;South Korea&#39;, &#39;pr_keyword_th&#39;: &#39;&#39;, &#39;pr_keyword_en&#39;: &#39;samyang,instant noodle,noodle,korean noodle,korean,instant noodles&#39;, &#39;pr_filter_th&#39;: &#39;Grocery,Rice  Pasta  Beans&#39;, &#39;pr_filter_en&#39;: &#39;Grocery,Rice  Pasta  Beans&#39;, &#39;online_category_l1_th&#39;: &#39;สินค้าบริโภค&#39;, &#39;online_category_l1_en&#39;: &#39;Grocery&#39;, &#39;online_category_l2_th&#39;: &#39;ข้าว เส้นพาสต้า และ ถั่ว&#39;, &#39;online_category_l2_en&#39;: &#39;Rice &amp; Pasta &amp; Beans&#39;, &#39;online_category_l3_th&#39;: &#39;&#39;, &#39;online_category_l3_en&#39;: &#39;&#39;, &#39;villa_category_l1_en&#39;: &#39;Dry Grocery&#39;, &#39;villa_category_l2_en&#39;: &#39;Grocery&#39;, &#39;villa_category_l3_en&#39;: &#39;Rice &amp; Noodles &amp; Japanese&#39;, &#39;villa_category_l4_en&#39;: &#39;Noodles&#39;, &#39;content_en&#39;: &#39;0223750 Samyang Hot Chickhen Carbonarag 130g samyang,instant noodle,noodle,korean noodle,korean,instant noodles&#39;, &#39;content_th&#39;: &#39;Samyang Hot Chickhen Carbonarag 130g&#39;, &#39;hema_brand_th&#39;: &#39;Samyang&#39;, &#39;hema_brand_en&#39;: &#39;Samyang&#39;, &#39;hema_sizedesc&#39;: &#39;130g&#39;, &#39;pr_brand_en&#39;: &#39;&#39;, &#39;pr_brand_th&#39;: &#39;&#39;, &#39;pr_online_name_en&#39;: &#39;Samyang Hot Chickhen Carbonarag 130g&#39;, &#39;pr_online_name_th&#39;: &#39;Samyang Hot Chickhen Carbonarag 130g&#39;, &#39;hema_name_en&#39;: &#39;Hot Chickhen Carbonarag&#39;, &#39;hema_name_th&#39;: &#39;Hot Chickhen Carbonarag&#39;, &#39;pr_name_en&#39;: &#39;SAMYANG HOT CHICKHEN CARBONARA130G&#39;, &#39;pr_name_th&#39;: &#39;SAMYANG ฮอตชิคเค่น คาโบนาร่า 130กรัม&#39;, &#39;pr_barcode&#39;: &#39;8801073113893&#39;, &#39;pr_barcode2&#39;: &#39;880107311389&#39;, &#39;sort_weight&#39;: &#39;0&#39;}]
</pre>
</div>
</div>

</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h2 id="Get-rid-of-error-item">Get rid of error item<a class="anchor-link" href="#Get-rid-of-error-item"> </a></h2>
</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="k">def</span> <span class="nf">replaceEmptystringWithNone</span><span class="p">(</span><span class="n">inputListOfDict</span><span class="p">:</span><span class="nb">list</span><span class="p">):</span>
  <span class="n">newList</span> <span class="o">=</span> <span class="p">[]</span>
  <span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="n">inputListOfDict</span><span class="p">:</span>
    <span class="n">newItem</span> <span class="o">=</span> <span class="p">{</span><span class="n">k</span><span class="p">:</span><span class="n">v</span> <span class="k">if</span> <span class="n">v</span> <span class="k">else</span> <span class="s1">&#39;none&#39;</span> <span class="k">for</span> <span class="n">k</span><span class="p">,</span><span class="n">v</span> <span class="ow">in</span> <span class="n">item</span><span class="o">.</span><span class="n">items</span><span class="p">()}</span>
    <span class="n">newList</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">newItem</span><span class="p">)</span>
  <span class="k">return</span> <span class="n">newList</span>
    
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="o">%%time</span>
<span class="n">filledItems</span> <span class="o">=</span> <span class="n">replaceEmptystringWithNone</span><span class="p">(</span><span class="n">items</span><span class="p">)</span>
<span class="nb">len</span><span class="p">(</span><span class="n">filledItems</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">



<div class="output_text output_subarea output_execute_result">
<pre>68978</pre>
</div>

</div>

</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h2 id="update-items-with-s3">update items with s3<a class="anchor-link" href="#update-items-with-s3"> </a></h2>
</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="o">%%time</span>
<span class="n">psdk</span><span class="o">.</span><span class="n">updateWithS3</span><span class="p">(</span><span class="n">filledItems</span><span class="p">,</span> <span class="n">invocationType</span><span class="o">=</span><span class="s1">&#39;Event&#39;</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">



<div class="output_text output_subarea output_execute_result">
<pre>&#39;successfully sent event, please watch your slack&#39;</pre>
</div>

</div>

</div>
</div>

</div>
    {% endraw %}

</div>
 

